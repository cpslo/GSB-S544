<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jenny Luu">

<title>Lab 1: Gapminder Data Visualization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="Lab01_files/libs/clipboard/clipboard.min.js"></script>
<script src="Lab01_files/libs/quarto-html/quarto.js"></script>
<script src="Lab01_files/libs/quarto-html/popper.min.js"></script>
<script src="Lab01_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Lab01_files/libs/quarto-html/anchor.min.js"></script>
<link href="Lab01_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Lab01_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Lab01_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Lab01_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Lab01_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 1: Gapminder Data Visualization</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jenny Luu </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div id="2a832f8041e8cd72" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-09-26T21:51:33.951420Z&quot;,&quot;start_time&quot;:&quot;2024-09-26T21:51:33.947654Z&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, aes, geom_jitter, geom_point, scale_size, scale_color_manual, labs, theme_minimal, scale_x_continuous, scale_y_continuous</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="working-with-data-of-global-indicators---gapminder" class="level2">
<h2 class="anchored" data-anchor-id="working-with-data-of-global-indicators---gapminder">Working with Data of Global Indicators - Gapminder</h2>
<p>“Gapminder identifies systematic misconceptions about important global trends and proportions and uses reliable data to develop easy to understand teaching materials to rid people of their misconceptions.”</p>
</section>
<section id="task-1" class="level2">
<h2 class="anchored" data-anchor-id="task-1">Task 1</h2>
<p>Below is a plot of a visualization in Gapminder (the default/starting one actually). Look it over and take note of the variables being visualized.</p>
<p><img src="gapminder_pic.png" width="700" height="350"></p>
<ol type="1">
<li>Identify, and list here, what aesthetics are being used and which variables are being mapped to each aesthetic.</li>
</ol>
<p>For the year 2010:</p>
<pre><code>- Income is the variable for the X axis.
- Life expectancy is the variable for the Y axis.
- A bubble chart is being used to visualize the data
- Income is measured per person as GDP per capita (PPPS inflation-adjusted)
- Color is based on world region
- The chart is sectioned in to 4 income levels
- The size of the bubble chart is depicted on the population of each region
- Region is being mapped to fill/color aesthetic, with different colors representing different regions.</code></pre>
<ol start="2" type="1">
<li>Import the q1data.csv dataset.</li>
</ol>
<div id="57843a6cb4296435" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-09-26T21:51:33.990702Z&quot;,&quot;start_time&quot;:&quot;2024-09-26T21:51:33.979436Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>q1data <span class="op">=</span> pd.read_csv(<span class="st">'Data/q1data.csv'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>q1data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">income</th>
<th data-quarto-table-cell-role="th">life_exp</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">four_regions</th>
<th data-quarto-table-cell-role="th">six_regions</th>
<th data-quarto-table-cell-role="th">eight_regions</th>
<th data-quarto-table-cell-role="th">world_bank_region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1910.0</td>
<td>61.0</td>
<td>29200000.0</td>
<td>2010</td>
<td>Afghanistan</td>
<td>asia</td>
<td>south_asia</td>
<td>asia_west</td>
<td>South Asia</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>11100.0</td>
<td>78.1</td>
<td>2950000.0</td>
<td>2010</td>
<td>Albania</td>
<td>europe</td>
<td>europe_central_asia</td>
<td>europe_east</td>
<td>Europe &amp; Central Asia</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>11100.0</td>
<td>74.7</td>
<td>36000000.0</td>
<td>2010</td>
<td>Algeria</td>
<td>africa</td>
<td>middle_east_north_africa</td>
<td>africa_north</td>
<td>Middle East &amp; North Africa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>46900.0</td>
<td>81.9</td>
<td>84500.0</td>
<td>2010</td>
<td>Andorra</td>
<td>europe</td>
<td>europe_central_asia</td>
<td>europe_west</td>
<td>Europe &amp; Central Asia</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7680.0</td>
<td>60.8</td>
<td>23400000.0</td>
<td>2010</td>
<td>Angola</td>
<td>africa</td>
<td>sub_saharan_africa</td>
<td>africa_sub_saharan</td>
<td>Sub-Saharan Africa</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.12/pprint.py:632: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab01_files/figure-html/cell-3-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Recreate the plot as best you can using plotnine.</li>
</ol>
<p>Sources: https://datacarpentry.org/python-ecology-lesson/07-visualization-ggplot-python.html</p>
<p>https://stackoverflow.com/questions/73632511/how-do-i-set-scaling-for-axes-using-plotnine</p>
<div id="96fa5a3d" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, aes, geom_point, scale_size_continuous, scale_x_log10, scale_fill_manual, labs, theme_minimal, annotate, guides, theme</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>region_colors <span class="op">=</span> {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Africa'</span>: <span class="st">'#377eb8'</span>,    </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Asia'</span>: <span class="st">'#e41a1c'</span>,      </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Europe'</span>: <span class="st">'#ffeb00'</span>,    </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Americas'</span>: <span class="st">'#4daf4a'</span>   </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>q1data[<span class="st">'four_regions'</span>] <span class="op">=</span> q1data[<span class="st">'four_regions'</span>].<span class="bu">str</span>.capitalize()</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> (ggplot(q1data.dropna(), aes(x<span class="op">=</span><span class="st">'income'</span>, y<span class="op">=</span><span class="st">'life_exp'</span>, size<span class="op">=</span><span class="st">'population'</span>, fill<span class="op">=</span><span class="st">'four_regions'</span>))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_point(alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_size_continuous(<span class="bu">range</span><span class="op">=</span>[<span class="dv">1</span>, <span class="dv">15</span>])  </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme_minimal()</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> labs(x<span class="op">=</span><span class="st">'Income'</span>, y<span class="op">=</span><span class="st">'Life Expectancy'</span>, </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>               fill<span class="op">=</span><span class="st">'Region'</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>               title<span class="op">=</span><span class="st">"Global Life Expectancy vs Income: A Population Perspective"</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> guides(size<span class="op">=</span><span class="va">False</span>)  </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_x_log10(breaks<span class="op">=</span>[<span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">2000</span>, <span class="dv">4000</span>, <span class="dv">8000</span>, <span class="dv">16000</span>, <span class="dv">32000</span>, <span class="dv">64000</span>])</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> annotate(<span class="st">"text"</span>, x<span class="op">=</span><span class="dv">10000</span>, y<span class="op">=</span><span class="dv">65</span>, label<span class="op">=</span><span class="st">"2010"</span>, </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                   size<span class="op">=</span><span class="dv">80</span>, color<span class="op">=</span><span class="st">"grey"</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, ha<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> annotate(<span class="st">"text"</span>, x<span class="op">=</span><span class="dv">60000</span>, y<span class="op">=</span><span class="dv">45</span>, label<span class="op">=</span><span class="st">"*Bubble size reflects population size"</span>, </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                   size<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_fill_manual(values<span class="op">=</span>region_colors)  </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme(legend_position<span class="op">=</span><span class="st">'right'</span>))</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.12/pprint.py:632: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab01_files/figure-html/cell-4-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>What other geometries could you use here besides geom_point? Provide an actual plot of another geometry being used here and why it’s good or bad for visualizing these data.</li>
</ol>
<p>Besides using <code>geom_point</code>, another option would be to use <code>geom_jitter</code> and <code>geom_line</code> plots together. While a line plot (<code>geom_line</code>) alone can show trends or connections across data points, it lacks the ability to indicate population size. This is why it’s beneficial to integrate <code>geom_jitter</code>—to help spread the data points and show population size through bubble size. Combining these geometries provides both a sense of relationships between variables (through the line plot) and an understanding of data density or importance (through the size of the jittered points).</p>
<div id="2798872e" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, aes, geom_point, geom_line, geom_jitter, scale_size_continuous, scale_x_log10, scale_fill_manual, scale_color_manual, labs, theme_minimal, annotate, guides, theme</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>region_colors <span class="op">=</span> {</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Africa'</span>: <span class="st">'#377eb8'</span>,    </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Asia'</span>: <span class="st">'#e41a1c'</span>,     </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Europe'</span>: <span class="st">'#ffeb00'</span>,   </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Americas'</span>: <span class="st">'#4daf4a'</span>   </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>q1data[<span class="st">'four_regions'</span>] <span class="op">=</span> q1data[<span class="st">'four_regions'</span>].<span class="bu">str</span>.capitalize()</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> (ggplot(q1data.dropna(), aes(x<span class="op">=</span><span class="st">'income'</span>, y<span class="op">=</span><span class="st">'life_exp'</span>, size<span class="op">=</span><span class="st">'population'</span>, fill<span class="op">=</span><span class="st">'four_regions'</span>, color<span class="op">=</span><span class="st">'four_regions'</span>))</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_point(alpha<span class="op">=</span><span class="fl">0.8</span>)  <span class="co"># Main points (bubbles)</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_line(aes(group<span class="op">=</span><span class="st">'four_regions'</span>), alpha<span class="op">=</span><span class="fl">0.5</span>)  </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_jitter(width<span class="op">=</span><span class="fl">0.1</span>, height<span class="op">=</span><span class="fl">0.1</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)  </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_size_continuous(<span class="bu">range</span><span class="op">=</span>[<span class="dv">1</span>, <span class="dv">15</span>])  </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme_minimal()</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> labs(x<span class="op">=</span><span class="st">'Income'</span>, y<span class="op">=</span><span class="st">'Life Expectancy'</span>, </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>               fill<span class="op">=</span><span class="st">'Region'</span>, color<span class="op">=</span><span class="st">'Region'</span>,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>               title<span class="op">=</span><span class="st">"Global Life Expectancy vs Income: A Population Perspective"</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> guides(size<span class="op">=</span><span class="va">False</span>)  <span class="co"># Remove the population (size) legend</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_x_log10(breaks<span class="op">=</span>[<span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">2000</span>, <span class="dv">4000</span>, <span class="dv">8000</span>, <span class="dv">16000</span>, <span class="dv">32000</span>, <span class="dv">64000</span>])</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> annotate(<span class="st">"text"</span>, x<span class="op">=</span><span class="dv">10000</span>, y<span class="op">=</span><span class="dv">65</span>, label<span class="op">=</span><span class="st">"2010"</span>, </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>                   size<span class="op">=</span><span class="dv">80</span>, color<span class="op">=</span><span class="st">"grey"</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, ha<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> annotate(<span class="st">"text"</span>, x<span class="op">=</span><span class="dv">60000</span>, y<span class="op">=</span><span class="dv">45</span>, label<span class="op">=</span><span class="st">"*Bubble size reflects population size"</span>, </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>                   size<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_fill_manual(values<span class="op">=</span>region_colors)  </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_color_manual(values<span class="op">=</span>region_colors)  </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme(legend_position<span class="op">=</span><span class="st">'right'</span>))</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.12/pprint.py:632: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab01_files/figure-html/cell-5-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-2" class="level2">
<h2 class="anchored" data-anchor-id="task-2">Task 2</h2>
<p>Below is another plot of a visualization in Gapminder. Look it over and take note of the variables being visualized.</p>
<p><img src="1997.png" width="700" height="350"></p>
<ol type="1">
<li>Identify, and list here, what aesthetics are being used and which variables are being mapped to each aesthetic.</li>
</ol>
<p>For the year 1997:</p>
<pre><code>- The X axis is Exports measured in % of GDP
- The Y axis is Imports measured in % of GDP
- The Bubble Size is represented by energy use
- The Year (1997) is shown in large and faded text in the background to indicate the year of the data being visualized
- The color represents the different world regions as indicated by the color-coded map legend, using the fill/color aesthetic</code></pre>
<ol start="2" type="1">
<li>Import the q2data.csv dataset. Tidy data before importing dataset because k is a non-numerical indicator and converting it to a numerical indicator.</li>
</ol>
<div id="d5e96a29" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>q2data <span class="op">=</span> pd.read_csv(<span class="st">'Data/q2data.csv'</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>q2data <span class="op">=</span> q2data.dropna()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_k_to_numeric(value):</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(value, <span class="bu">str</span>) <span class="kw">and</span> <span class="st">'k'</span> <span class="kw">in</span> value:</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">float</span>(value.replace(<span class="st">'k'</span>, <span class="st">''</span>)) <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> value </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>q2data[<span class="st">'energy'</span>] <span class="op">=</span> q2data[<span class="st">'energy'</span>].<span class="bu">apply</span>(convert_k_to_numeric).astype(<span class="bu">int</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>q2data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">imports</th>
<th data-quarto-table-cell-role="th">exports</th>
<th data-quarto-table-cell-role="th">energy</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">four_regions</th>
<th data-quarto-table-cell-role="th">six_regions</th>
<th data-quarto-table-cell-role="th">eight_regions</th>
<th data-quarto-table-cell-role="th">world_bank_region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>36.7</td>
<td>11.5</td>
<td>427</td>
<td>1997</td>
<td>Albania</td>
<td>europe</td>
<td>europe_central_asia</td>
<td>europe_east</td>
<td>Europe &amp; Central Asia</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>22.5</td>
<td>22.6</td>
<td>825</td>
<td>1997</td>
<td>Algeria</td>
<td>africa</td>
<td>middle_east_north_africa</td>
<td>africa_north</td>
<td>Middle East &amp; North Africa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>12.9</td>
<td>10.4</td>
<td>1660</td>
<td>1997</td>
<td>Argentina</td>
<td>americas</td>
<td>america</td>
<td>america_south</td>
<td>Latin America &amp; Caribbean</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>52.8</td>
<td>19.0</td>
<td>610</td>
<td>1997</td>
<td>Armenia</td>
<td>europe</td>
<td>europe_central_asia</td>
<td>europe_east</td>
<td>Europe &amp; Central Asia</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>20.5</td>
<td>19.6</td>
<td>5550</td>
<td>1997</td>
<td>Australia</td>
<td>asia</td>
<td>east_asia_pacific</td>
<td>east_asia_pacific</td>
<td>East Asia &amp; Pacific</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.12/pprint.py:632: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab01_files/figure-html/cell-6-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Recreate the plot as best you can using plotnine.</li>
</ol>
<p>Sources: https://plotnine.org/reference/guide.html</p>
<p>https://ggplot2.tidyverse.org/reference/ggtheme.html</p>
<div id="3420da26" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, aes, geom_point, scale_size_continuous, scale_x_continuous, scale_y_continuous, scale_fill_manual, labs, theme_minimal, annotate, guides, theme</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>region_colors <span class="op">=</span> {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Africa'</span>: <span class="st">'#377eb8'</span>,    </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Asia'</span>: <span class="st">'#e41a1c'</span>,      </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Europe'</span>: <span class="st">'#ffeb00'</span>,    </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Americas'</span>: <span class="st">'#4daf4a'</span>   </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>q2data[<span class="st">'four_regions'</span>] <span class="op">=</span> q2data[<span class="st">'four_regions'</span>].<span class="bu">str</span>.capitalize()</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> (ggplot(q2data.dropna(), aes(x<span class="op">=</span><span class="st">'exports'</span>, y<span class="op">=</span><span class="st">'imports'</span>, size<span class="op">=</span><span class="st">'energy'</span>, fill<span class="op">=</span><span class="st">'four_regions'</span>))</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_point(alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_size_continuous(<span class="bu">range</span><span class="op">=</span>[<span class="dv">1</span>, <span class="dv">15</span>])  </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme_minimal()</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> labs(x<span class="op">=</span><span class="st">'Exports (</span><span class="sc">% o</span><span class="st">f GDP)'</span>, y<span class="op">=</span><span class="st">'Imports (</span><span class="sc">% o</span><span class="st">f GDP)'</span>, </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>               fill<span class="op">=</span><span class="st">'Region'</span>,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>               title<span class="op">=</span><span class="st">"Exports vs. Imports: An Energy Use Perspective"</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> guides(size<span class="op">=</span><span class="va">False</span>)  </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_y_continuous(limits<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">400</span>]) </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_x_continuous(limits<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">230</span>])  </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> annotate(<span class="st">"text"</span>, x<span class="op">=</span><span class="dv">110</span>, y<span class="op">=</span><span class="dv">200</span>, label<span class="op">=</span><span class="st">"1997"</span>,  </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>                   size<span class="op">=</span><span class="dv">80</span>, color<span class="op">=</span><span class="st">"grey"</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, ha<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> annotate(<span class="st">"text"</span>, x<span class="op">=</span><span class="dv">190</span>, y<span class="op">=</span><span class="dv">30</span>, label<span class="op">=</span><span class="st">"*Bubble size reflects Energy Use"</span>, </span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>                   size<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_fill_manual(values<span class="op">=</span>region_colors)  </span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme(legend_position<span class="op">=</span><span class="st">'right'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.12/pprint.py:632: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab01_files/figure-html/cell-7-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>What other geometries could you use here besides geom_point? Provide an actual plot of another geometry being used here and why it’s good or bad for visualizing these data.</li>
</ol>
<p>Using <code>geom_density_2d</code> in this plot provides valuable insights into the distribution and density of the data points. The contour lines created by <code>geom_density_2d</code> effectively highlight areas where data points are most densely concentrated, helping to visualize clusters that may be difficult to identify with just <code>geom_point</code>. This is particularly useful for reducing overplotting, as many overlapping points can obscure the underlying data patterns. By showing density through contour lines, <code>geom_density_2d</code> makes it easier to interpret areas with higher occurrences without cluttering the graph. Additionally, the contour lines help in identifying general trends by grouping similar data points, offering a clearer understanding of how exports and imports vary across regions in relation to energy use. Overall, <code>geom_density_2d</code> is a valuable tool for visualizing patterns, reducing overplotting, and enhancing the interpretability of scatterplots.</p>
<div id="204d8780" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, aes, geom_point, geom_density_2d, labs, theme_minimal, scale_x_continuous, scale_y_continuous</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> (</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    ggplot(q2data, aes(x<span class="op">=</span><span class="st">'exports'</span>, y<span class="op">=</span><span class="st">'imports'</span>, color<span class="op">=</span><span class="st">'four_regions'</span>)) <span class="op">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    geom_point(alpha<span class="op">=</span><span class="fl">0.7</span>) <span class="op">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    geom_density_2d() <span class="op">+</span>  </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    labs(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">'Exports (</span><span class="sc">% o</span><span class="st">f GDP)'</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">'Imports (</span><span class="sc">% o</span><span class="st">f GDP)'</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'World Region'</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">'Exports vs. Imports: An Energy Use Perspective'</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    scale_x_continuous(limits<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">230</span>]) <span class="op">+</span>  </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    scale_y_continuous(limits<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">400</span>]) <span class="op">+</span>  </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    theme_minimal()</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.12/pprint.py:632: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab01_files/figure-html/cell-8-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-3" class="level2">
<h2 class="anchored" data-anchor-id="task-3">Task 3</h2>
<p>Below is a final plot of a visualization in Gapminder. Look it over and take note of the variables being visualized.</p>
<p><img src="2001.png" width="750" height="250"></p>
<ol type="1">
<li>Identify, and list here, what aesthetics are being used and which variables are being mapped to each aesthetic.</li>
</ol>
<p>For the year 1997:</p>
<pre><code>- The X axis is Indivuals using the Internet 
- The Y axis is GDP per capita
- The Bubble Size is represented by income 
- The Year (2001) is shown in large and faded text in the background to indicate the year of the data being visualized
- The color represents the different world regions as indicated by the color-coded map legend, using the fill/color aesthetic</code></pre>
<ol start="2" type="1">
<li>Import the q3data.csv dataset.</li>
</ol>
<div id="1b974322" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>q3data <span class="op">=</span> pd.read_csv(<span class="st">'Data/q3data.csv'</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>q3data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">internet_users</th>
<th data-quarto-table-cell-role="th">gdp</th>
<th data-quarto-table-cell-role="th">income</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">four_regions</th>
<th data-quarto-table-cell-role="th">six_regions</th>
<th data-quarto-table-cell-role="th">eight_regions</th>
<th data-quarto-table-cell-role="th">world_bank_region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.00456</td>
<td>330.0</td>
<td>1190.0</td>
<td>2001</td>
<td>Afghanistan</td>
<td>asia</td>
<td>south_asia</td>
<td>asia_west</td>
<td>South Asia</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.39000</td>
<td>2570.0</td>
<td>6780.0</td>
<td>2001</td>
<td>Albania</td>
<td>europe</td>
<td>europe_central_asia</td>
<td>europe_east</td>
<td>Europe &amp; Central Asia</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.59000</td>
<td>3770.0</td>
<td>9230.0</td>
<td>2001</td>
<td>Algeria</td>
<td>africa</td>
<td>middle_east_north_africa</td>
<td>africa_north</td>
<td>Middle East &amp; North Africa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>10500.0</td>
<td>NaN</td>
<td>2001</td>
<td>American Samoa</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>11.30000</td>
<td>42600.0</td>
<td>35600.0</td>
<td>2001</td>
<td>Andorra</td>
<td>europe</td>
<td>europe_central_asia</td>
<td>europe_west</td>
<td>Europe &amp; Central Asia</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.12/pprint.py:632: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab01_files/figure-html/cell-9-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Recreate the plot as best you can using plotnine.</li>
</ol>
<p>Sources:</p>
<div id="a1d68397" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, aes, geom_point, theme_linedraw, scale_y_log10, scale_size_continuous, scale_x_continuous, scale_fill_manual, labs, annotate, guides, theme</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>region_colors <span class="op">=</span> {</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Africa'</span>: <span class="st">'#377eb8'</span>,    </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Asia'</span>: <span class="st">'#e41a1c'</span>,      </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Europe'</span>: <span class="st">'#ffeb00'</span>,    </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Americas'</span>: <span class="st">'#4daf4a'</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>q3data_filtered <span class="op">=</span> q3data.dropna(subset<span class="op">=</span>[<span class="st">'four_regions'</span>])</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> (ggplot(q3data_filtered, aes(x<span class="op">=</span><span class="st">'internet_users'</span>, y<span class="op">=</span><span class="st">'gdp'</span>, size<span class="op">=</span><span class="st">'income'</span>, fill<span class="op">=</span><span class="st">'four_regions'</span>))</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_point(alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> scale_size_continuous(<span class="bu">range</span><span class="op">=</span>[<span class="dv">1</span>, <span class="dv">20</span>])  </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme_linedraw() </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(x<span class="op">=</span><span class="st">'Internet Users (</span><span class="sc">% o</span><span class="st">f population)'</span>, y<span class="op">=</span><span class="st">'GDP/capita'</span>, </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>           fill<span class="op">=</span><span class="st">'Region'</span>, title<span class="op">=</span><span class="st">"Internet Users vs GDP/capita: An Income Perspective"</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> scale_y_log10(breaks<span class="op">=</span>[<span class="dv">200</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">2000</span>, <span class="dv">5000</span>, <span class="dv">10000</span>, <span class="dv">20000</span>, <span class="dv">50000</span>, <span class="dv">100000</span>])  </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> scale_x_continuous(breaks<span class="op">=</span>[<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>])  </span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> annotate(<span class="st">"text"</span>, x<span class="op">=</span><span class="dv">50</span>, y<span class="op">=</span><span class="dv">5000</span>, label<span class="op">=</span><span class="st">"2001"</span>, size<span class="op">=</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">"grey"</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, ha<span class="op">=</span><span class="st">'center'</span>)  </span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> annotate(<span class="st">"text"</span>, x<span class="op">=</span><span class="dv">100</span>, y<span class="op">=</span><span class="dv">250</span>, label<span class="op">=</span><span class="st">"*Bubble size reflects Income"</span>, size<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, ha<span class="op">=</span><span class="st">'right'</span>)  </span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> scale_fill_manual(values<span class="op">=</span>region_colors)  </span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> guides(size<span class="op">=</span><span class="va">False</span>)  </span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme(legend_position<span class="op">=</span><span class="st">'right'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.12/pprint.py:632: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/opt/anaconda3/lib/python3.12/site-packages/plotnine/layer.py:364: PlotnineWarning: geom_point : Removed 12 rows containing missing values.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab01_files/figure-html/cell-10-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>What other geometries could you use here besides geom_point? Provide an actual plot of another geometry being used here and why it’s good or bad for visualizing these data.</li>
</ol>
<p>Using <code>geom_smooth</code> in this plot is effective because it provides a clear representation of the overall trend between internet users and GDP per capita. Specifically, the regression line helps summarize the relationship between these variables for different world regions. The positive correlation between internet usage and GDP per capita is visually apparent through the trend lines, which are color-coded by region, making it easy to identify and compare patterns across different areas of the world. Additionally, the confidence intervals, shown as shaded regions around the trend lines, give a sense of uncertainty in the estimates, which enhances the interpretation of how internet usage may predict GDP per capita for each region.</p>
<p>This geometry is particularly useful for highlighting overall trends in a simplified manner. It helps avoid the clutter that individual data points might create, especially in large datasets, and instead focuses on the broader patterns. By allowing for a region-based comparison, <code>geom_smooth</code> also helps in understanding how the impact of internet usage on GDP varies globally.</p>
<p>However, a limitation of this approach is that it may obscure individual variations and outliers within each region. Important data points that fall outside of the general trend might not be easily visible, which can sometimes lead to missing key details that could influence the analysis. While <code>geom_smooth</code> is effective for visualizing trends, it might not fully capture the complexity of the dataset in cases where outliers or detailed data points are significant.</p>
<p>Sources: https://ggplot2.tidyverse.org/reference/geom_smooth.html</p>
<p>https://stackoverflow.com/questions/16562859/ggplot2-colour-geom-point-by-factor-but-geom-smooth-based-on-all-data</p>
<div id="d747d7ef" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, aes, geom_smooth, scale_x_continuous, scale_y_log10, labs, theme_minimal, annotate, theme, element_text</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot using geom_smooth with linear regression method</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> (ggplot(q3data_filtered, aes(x<span class="op">=</span><span class="st">'internet_users'</span>, y<span class="op">=</span><span class="st">'gdp'</span>, color<span class="op">=</span><span class="st">'four_regions'</span>))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_smooth(method<span class="op">=</span><span class="st">'lm'</span>)  <span class="co"># Using linear regression for the trend line</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_x_continuous(breaks<span class="op">=</span>[<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>], name<span class="op">=</span><span class="st">"Individuals using the Internet (</span><span class="sc">% o</span><span class="st">f population)"</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_y_log10(breaks<span class="op">=</span>[<span class="dv">200</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">2000</span>, <span class="dv">5000</span>, <span class="dv">10000</span>, <span class="dv">20000</span>, <span class="dv">50000</span>, <span class="dv">100000</span>], name<span class="op">=</span><span class="st">"GDP per capita (US$, inflation-adjusted)"</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> labs(title<span class="op">=</span><span class="st">"Internet Users vs GDP per capita (2001) with Linear Trend"</span>, color<span class="op">=</span><span class="st">"World Regions"</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> annotate(<span class="st">"text"</span>, x<span class="op">=</span><span class="dv">50</span>, y<span class="op">=</span><span class="dv">5000</span>, label<span class="op">=</span><span class="st">"2001"</span>, size<span class="op">=</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">"grey"</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, ha<span class="op">=</span><span class="st">'center'</span>)  <span class="co"># Year annotation in the middle</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme_minimal()</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme(</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>            legend_position<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>            plot_title<span class="op">=</span>element_text(ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'top'</span>, size<span class="op">=</span><span class="dv">16</span>)  <span class="co"># Center the title</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.12/pprint.py:632: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab01_files/figure-html/cell-11-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>